<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Lua Module - AO Physics</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/style.css" rel="stylesheet" />
        <link href="../assets/vscode.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lua Module";
        var mkdocs_page_input_path = "lua_module.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../img/AOP.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Classes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../world/">World</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../body/">Body</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../constraint/">Constraint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../character/">Character</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/basic/">Basic Example</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Lua Module</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">AO Physics</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Other</li>
      <li class="breadcrumb-item active">Lua Module</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lua-module">Lua Module</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Lua module in this documentation provides a convenient interface for interacting with the AO Physics library, which is implemented in C++. The module allows users to create and manipulate physics bodies, apply forces and constraints, and simulate physics interactions.</p>
<p>To use the Lua module, you need to require the "aop" module, which internally loads the C++ AO Physics library. Additionally, you will need to import other Lua modules such as "json" and "class" for JSON encoding and class creation, respectively.</p>
<p>Overall, the Lua module provides a high-level interface for working with the AO Physics library, making it easier to integrate physics simulations into Lua-based applications.</p>
</div>
<pre><code class="language-lua">_AOP = require(&quot;aop&quot;)
local json = require('json')
local class = require('class')

AOPModule = class(function(aop) end)

AOP = AOPModule()

function AOP:Body()
  local body = {}
  body.id = -1
  body.data = {} -- Used to store custom data
  body.position = { 0, 0, 0 }
  body.rotation = { 0, 0, 0, 1 }
  body.linearVelocity = { 0, 0, 0 }
  body.angularVelocity = { 0, 0, 0 }
  body.motionType = &quot;Dynamic&quot;     -- &quot;Dynamic&quot; | &quot;Static&quot; | &quot;Kinematic&quot;
  body.motionQuality = &quot;Discrete&quot; -- &quot;Discrete&quot; | &quot;LinearCast&quot;
  body.layer = &quot;MOVING&quot;           -- &quot;MOVING&quot; | &quot;NON_MOVING&quot;
  body.shape = &quot;Box&quot;              -- &quot;Box&quot; | &quot;Sphere&quot; | &quot;Capsule&quot; | &quot;Cylinder&quot;
  body.activate = true
  body.enhancedInternalEdgeRemoval = false
  body.allowSleeping = true
  body.friction = 0.2
  body.restitution = 0.0
  body.linearDamping = 0.05
  body.angularDamping = 0.05
  body.maxLinearVelocity = 500.0
  body.maxAngularVelocity = 0.25 * 3.14159265359 * 60.0
  body.gravityFactor = 1.0
  body.size = { 1, 1, 1 }
  body.radius = 0.5
  body.height = 2.0

  function body:Add()
    self.data = json.encode(self.data);
    self.id = math.floor(_AOP.add_body(json.encode(self)))
    self.data = json.decode(self.data);
  end

  function body:SetData(data)
    _AOP.set_data_body(self.id, json.encode(data))
  end

  function body:GetData()
    return json.decode(_AOP.get_data_body(self.id))
  end

  function body:SetLinearVelocity(velocity --[[{x, y, z}]])
    _AOP.set_linear_velocity(self.id, velocity[1], velocity[2], velocity[3])
  end

  function body:SetAngularVelocity(velocity --[[{x, y, z}]])
    _AOP.set_angular_velocity(self.id, velocity[1], velocity[2], velocity[3])
  end

  function body:AddLinearVelocity(velocity --[[{x, y, z}]])
    _AOP.add_linear_velocity(self.id, velocity[1], velocity[2], velocity[3])
  end

  function body:AddAngularVelocity(velocity --[[{x, y, z}]])
    _AOP.add_angular_velocity(self.id, velocity[1], velocity[2], velocity[3])
  end

  function body:AddForce(force --[[{x, y, z}]])
    _AOP.add_force(self.id, force[1], force[2], force[3])
  end

  function body:AddTorque(torque --[[{x, y, z}]])
    _AOP.add_torque(self.id, torque[1], torque[2], torque[3])
  end

  function body:AddImpulse(impulse --[[{x, y, z}]])
    _AOP.add_impulse(self.id, impulse[1], impulse[2], impulse[3])
  end

  function body:CastRay(direction --[[{x, y, z}]])
    local hit = json.decode(_AOP.cast_ray(self.id, direction[1], direction[2], direction[3]))
    local result = {
      hit = hit.hit,
      hitPoint = hit.hitPoint,
      hitBodyID = hit.hitBodyID
    }
    return result
  end

  function body:Remove()
    _AOP.remove_body(self.id)
  end

  return body;
end

function AOP:ConstraintHinge()
  local hingeConstraint = {};
  hingeConstraint.type = &quot;Hinge&quot;
  hingeConstraint.space = &quot;WorldSpace&quot;      -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  hingeConstraint.point1 = { 0, 0, 0 }      -- [float] x, y, z
  hingeConstraint.hingeAxis1 = { 0, 1, 0 }  -- [float] x, y, z
  hingeConstraint.normalAxis1 = { 1, 0, 0 } -- [float] x, y, z
  hingeConstraint.point2 = { 0, 0, 0 }      -- [float] x, y, z
  hingeConstraint.hingeAxis2 = { 0, 1, 0 }  -- [float] x, y, z
  hingeConstraint.normalAxis2 = { 1, 0, 0 } -- [float] x, y, z
  hingeConstraint.limitsMin = -180.0        -- [Degrees]
  hingeConstraint.limitsMax = 180           -- [float] Degrees
  hingeConstraint.maxFrictionTorque = 0.0
  hingeConstraint.limitsSpringSettings = {
    mode = &quot;FrequencyAndDamping&quot;, -- [string] &quot;FrequencyAndDamping&quot; | &quot;StiffnessAndDamping&quot;
    frequency = 0.0,
    stiffness = 0.0,
    damping = 0.0
  }
  hingeConstraint.motorSettings = {
    frequency = 0.0,
    damping = 0.0
  }
  hingeConstraint.motorState = &quot;Off&quot; -- &quot;Off&quot; | &quot;Velocity&quot; | &quot;Position&quot;
  hingeConstraint.targetAngularVelocity = 0.0
  hingeConstraint.targetAngle = 0.0

  function hingeConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function hingeConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return hingeConstraint;
end

function AOP:ConstraintSlider()
  local sliderConstraint = {};
  sliderConstraint.type = &quot;Slider&quot;
  sliderConstraint.space = &quot;WorldSpace&quot;      -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  sliderConstraint.autoDetectPoint = false
  sliderConstraint.point1 = { 0, 0, 0 }      -- [float] x, y, z
  sliderConstraint.sliderAxis1 = { 1, 0, 0 } -- [float] x, y, z
  sliderConstraint.normalAxis1 = { 0, 1, 0 } -- [float] x, y, z
  sliderConstraint.point2 = { 0, 0, 0 }      -- [float] x, y, z
  sliderConstraint.sliderAxis2 = { 1, 0, 0 } -- [float] x, y, z
  sliderConstraint.normalAxis2 = { 0, 1, 0 } -- [float] x, y, z
  sliderConstraint.limitsMin = -3.40282347e+38
  sliderConstraint.limitsMax = 3.40282347e+38
  sliderConstraint.maxFrictionForce = 0.0
  sliderConstraint.limitsSpringSettings = {
    mode = &quot;FrequencyAndDamping&quot;, -- [string] &quot;FrequencyAndDamping&quot; | &quot;StiffnessAndDamping&quot;
    frequency = 0.0,
    stiffness = 0.0,
    damping = 0.0
  }
  sliderConstraint.motorSettings = {
    frequency = 0.0,
    damping = 0.0
  }

  function sliderConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function sliderConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return sliderConstraint;
end

function AOP:ConstraintPulley()
  local pulleyConstraint = {};
  pulleyConstraint.type = &quot;Pulley&quot;
  pulleyConstraint.space = &quot;WorldSpace&quot;      -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  pulleyConstraint.bodyPoint1 = { 0, 0, 0 }  -- [float] x, y, z
  pulleyConstraint.fixedPoint1 = { 0, 0, 0 } -- [float] x, y, z
  pulleyConstraint.bodyPoint2 = { 0, 0, 0 }  -- [float] x, y, z
  pulleyConstraint.fixedPoint2 = { 0, 0, 0 } -- [float] x, y, z
  pulleyConstraint.ratio = 1.0
  pulleyConstraint.minLength = 0.0
  pulleyConstraint.maxLength = 0.0

  function pulleyConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function pulleyConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return pulleyConstraint;
end

function AOP:ConstraintPoint()
  local pointConstraint = {};
  pointConstraint.type = &quot;Point&quot;
  pointConstraint.space = &quot;WorldSpace&quot; -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  pointConstraint.point1 = { 0, 0, 0 } -- [float] x, y, z
  pointConstraint.point2 = { 0, 0, 0 } -- [float] x, y, z

  function pointConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function pointConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return pointConstraint;
end

function AOP:ConstraintGear()
  local gearConstraint = {};
  gearConstraint.type = &quot;Gear&quot;
  gearConstraint.space = &quot;WorldSpace&quot; -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  gearConstraint.numTeeth1 = 1
  gearConstraint.numTeeth2 = 1
  gearConstraint.hingeAxis1 = { 1, 0, 0 } -- [float] x, y, z
  gearConstraint.hingeAxis2 = { 1, 0, 0 } -- [float] x, y, z
  gearConstraint.ratio = 1.0

  function gearConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function gearConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return gearConstraint;
end

function AOP:ConstraintFixed()
  local fixedConstraint = {};
  fixedConstraint.type = &quot;Fixed&quot;
  fixedConstraint.space = &quot;WorldSpace&quot; -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  fixedConstraint.point1 = { 0, 0, 0 } -- [float] x, y, z
  fixedConstraint.axisX1 = { 0, 1, 0 } -- [float] x, y, z
  fixedConstraint.axisY1 = { 1, 0, 0 } -- [float] x, y, z
  fixedConstraint.point2 = { 0, 0, 0 } -- [float] x, y, z
  fixedConstraint.axisX2 = { 0, 1, 0 } -- [float] x, y, z
  fixedConstraint.axisY2 = { 1, 0, 0 } -- [float] x, y, z

  function fixedConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function fixedConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return fixedConstraint;
end

function AOP:ConstraintDistance()
  local distanceConstraint = {};
  distanceConstraint.type = &quot;Distance&quot;
  distanceConstraint.space = &quot;WorldSpace&quot; -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  distanceConstraint.point1 = { 0, 0, 0 } -- [float] x, y, z
  distanceConstraint.point2 = { 0, 0, 0 } -- [float] x, y, z
  distanceConstraint.minDistance = -1.0
  distanceConstraint.maxDistance = -1.0
  distanceConstraint.limitsSpringSettings = {
    mode = &quot;FrequencyAndDamping&quot;, -- [string] &quot;FrequencyAndDamping&quot; | &quot;StiffnessAndDamping&quot;
    frequency = 0.0,
    stiffness = 0.0,
    damping = 0.0
  }

  function distanceConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function distanceConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return distanceConstraint;
end

function AOP:ConstraintCone()
  local coneConstraint = {};
  coneConstraint.type = &quot;Cone&quot;
  coneConstraint.space = &quot;WorldSpace&quot;     -- &quot;WorldSpace&quot; | &quot;LocalToBodyCOM&quot;
  coneConstraint.point1 = { 0, 0, 0 }     -- [float] x, y, z
  coneConstraint.twistAxis1 = { 0, 1, 0 } -- [float] x, y, z
  coneConstraint.point2 = { 0, 0, 0 }     -- [float] x, y, z
  coneConstraint.twistAxis2 = { 0, 1, 0 } -- [float] x, y, z
  coneConstraint.halfConeAngle = 0.0

  function coneConstraint:Add(body1, body2)
    self.body1ID = body1.id
    self.body2ID = body2.id
    self.id = _AOP.add_constraint(json.encode(self))
    return self.id
  end

  function coneConstraint:Remove()
    _AOP.remove_constraint(self.id)
  end

  return coneConstraint;
end

function AOP:Character()
  local character = {
    canMoveWhileJumping = false,
    speed = 1.0,
    sprintSpeed = 2.0,
    jumpForce = 6.0,
    heightStanding = 1.35,
    radiusStanding = 0.3,
    maxSlopeAngle = 45.0,
    friction = 0.5,
    mass = 0.0,
    gravityFactor = 1.0,
    position = { 0, 0, 0 },
    rotation = { 0, 0, 0, 1 },
    up = { 0, 1, 0 },
    layer = &quot;MOVING&quot;, -- &quot;MOVING&quot; | &quot;NON_MOVING&quot;
    activate = true
  }
  character.id = -1;
  function character:Add()
    self.id = math.floor(_AOP.add_character(json.encode(self)))
    return self.id;
  end

  function character:Input()
    local input = {
      x = 0,
      z = 0,
      jump = false,
      sprint = false,
      crouch = false
    }
    return input
  end

  function character:SendInput(data)
    local msg = {
      id = self.id,
      input = { data.x, data.z },
      jump = data.jump,
      sprint = data.sprint,
      crouch = data.crouch
    }
    _AOP.move_character(json.encode(msg))
  end

  return character;
end

function AOP:World()
  local world = {
    gravity = { 0.0, -9.81, 0.0 },
    timeBeforeSleep = 0.5,
    allowSleeping = true,
    maxBodies = 1024,
    numBodyMutexes = 0,
    maxBodyPairs = 1024,
    maxContactConstraints = 1024
  }
  world.WorldStates = {}

  function world:Create()
    _AOP.world_create(json.encode(self))
  end

  function world:Update(steps, deltaTime)
    _AOP.world_update(steps, deltaTime)
  end

  function world:GetState()
    local worldState = _AOP.get_world_state()
    table.insert(self.WorldStates, worldState)
    return worldState
  end

  function world:GetStates()
    local state = [[{ &quot;worldStates&quot;: []]
    for i = 1, #self.WorldStates do
      state = state .. self.WorldStates[i] .. &quot;,&quot;
    end
    state = state:sub(1, #state - 1)
    state = state .. &quot;]}&quot;
    self.WorldStates = {}
    return state
  end

  function world:Destroy()
    _AOP.world_destroy()
  end

  return world;
end

return AOP
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../examples/basic/" class="btn btn-neutral float-left" title="Basic Example"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../examples/basic/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../assets/linenumbers.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
